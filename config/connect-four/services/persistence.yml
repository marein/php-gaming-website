services:

    connect-four.predis:
        class: Predis\Client
        public: false
        arguments:
            - '%env(APP_CONNECT_FOUR_PREDIS_CLIENT_URL)%'
            -
                prefix: 'connect-four.'

    connect-four.doctrine-dbal:
        alias: 'doctrine.dbal.connect_four_connection'

    connect-four.event-store:
        class: Gaming\Common\Port\Adapter\EventStore\DoctrineEventStore
        public: false
        arguments:
            - '@connect-four.doctrine-dbal'
            - 'event_store'
            - '@connect-four.normalizer'
            - '@clock'

    connect-four.shard-chooser:
        class: Gaming\Common\ShardChooser\ShardChooser
        arguments:
            - !service
                class: Gaming\Common\ShardChooser\Integration\DoctrineStorage
                arguments:
                    - '@connect-four.doctrine-dbal'
                    - 'USE %s'
            - !service
                class: Gaming\Common\ShardChooser\Integration\Crc32ModShards
                arguments:
                    - '%env(csv:APP_CONNECT_FOUR_DOCTRINE_DBAL_SHARDS)%'
