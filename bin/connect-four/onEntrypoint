#!/usr/bin/env bash

set -e

if [ "$RUN_CONNECT_FOUR_MIGRATIONS" = "1" ]
then
    for i in $(seq 1 3)
    do
        APPLICATION_CONNECT_FOUR_DOCTRINE_DBAL_DATABASE=connect-four-shard${i} bin/console doctrine:database:create \
            --connection=connect_four \
            --if-not-exists
        APPLICATION_CONNECT_FOUR_DOCTRINE_DBAL_DATABASE=connect-four-shard${i} bin/console doctrine:migrations:migrate \
            --configuration=config/connect-four/migrations.yml \
            --conn=connect_four \
            --allow-no-migration \
            --no-interaction
    done
fi
